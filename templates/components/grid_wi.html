<!-- === 模式 2: 世界书网格 (包含滚动、拖拽、分页) === -->
<div x-show="currentMode === 'worldinfo'" x-data="wiGrid" class="flex-1 flex flex-col overflow-hidden w-full relative">

    <!-- 滚动区域 -->
    <div id="wi-scroll-area" class="scroll-container-y p-4 custom-scrollbar relative"
        @dragover.prevent="dragOverWi = true" @dragleave.prevent="dragOverWi = false"
        @drop.prevent="handleWiFilesDrop($event)">

        <!-- 拖拽上传遮罩 -->
        <div x-show="dragOverWi" x-transition.opacity class="drag-over-main-overlay">
            <div class="text-6xl mb-4">🌎</div>
            <div class="text-2xl font-bold text-white tracking-wider">松开鼠标上传世界书</div>
            <div class="text-gray-300 mt-2 text-sm">将添加到全局目录 (Global)</div>
        </div>

        <div x-show="isLoading" style="text-align: center; padding: 5rem; color: var(--accent-light);">
            数据加载中...</div>

        <!-- 网格列表 -->
        <div x-show="!isLoading"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">
            <template x-for="item in wiList" :key="item.id">
                <div @click="openWiDetail(item)"
                    class="wi-grid-card group relative border rounded-xl p-3 cursor-pointer transition-all duration-200 flex flex-col h-44"
                    style="background: var(--bg-panel); border-color: var(--border-main);">

                    <!-- 来源标记：固定左上 -->
                    <div class="wi-badge" :class="item.type"
                        x-text="item.type === 'global' ? 'GLOBAL' : (item.type === 'resource' ? 'RESOURCE' : 'EMBEDDED')">
                    </div>

                    <!-- FILE 徽标：固定右上（去掉 inline style） -->
                    <div x-show="item.name_source === 'filename'" class="wi-badge file">FILE</div>

                    <!-- Hover 工具：编辑（保留原功能） -->
                    <button @click.stop="openWorldInfoEditor(item)"
                        class="wi-grid-tool-btn absolute top-2 right-2 w-9 h-9 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200 z-20 shadow-md"
                        title="打开全屏编辑器">
                        ✏️
                    </button>

                    <!-- 封面区 -->
                    <div class="wi-book-cover mt-6">
                        <div class="wi-book-icon">📖</div>
                    </div>

                    <!-- 标题区 -->
                    <div class="wi-book-title">
                        <h3 class="font-bold text-base leading-tight line-clamp-2"
                            :class="item.name_source === 'filename' ? 'wi-title-fallback' : ''"
                            style="color: var(--text-main);" x-text="item.name"></h3>
                    </div>

                    <!-- 信息条 -->
                    <div class="wi-book-meta">
                        <div class="flex items-center gap-1 max-w-[70%] min-w-0">
                            <template x-if="item.card_name">
                                <div class="flex items-center gap-1 truncate" title="关联角色">
                                    <span>🔗</span>
                                    <span class="truncate hover:text-[var(--text-main)] hover:underline"
                                        @click.stop="jumpToCardFromWi(item.card_id)" x-text="item.card_name"></span>
                                </div>
                            </template>
                            <template x-if="!item.card_name">
                                <span class="opacity-60 truncate">Global Lorebook</span>
                            </template>
                        </div>
                        <div class="font-mono opacity-70" x-text="new Date(item.mtime * 1000).toLocaleDateString()">
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <div x-show="!isLoading && wiList.length===0" class="text-center py-20 text-[var(--text-dim)]">
            <p class="text-lg">没有找到世界书</p>
            <p class="text-sm mt-2">（拖拽 .json 文件到此处添加）</p>
        </div>
    </div>

    <!-- 底部翻页栏 (World Info 专用) -->
    <div class="pagination-bar" x-show="wiList.length > 0 || wiCurrentPage > 1" style="flex-shrink: 0;">
        <span style="font-size: 0.75rem; color: var(--text-dim);">共 <span x-text="wiTotalItems"></span>
            本</span>
        <div style="display: flex; align-items: center; gap:  0.5rem;">
            <button @click="changeWiPage(wiCurrentPage-1)" :disabled="wiCurrentPage===1" class="btn-secondary"
                style="padding: 0.25rem 0.5rem;">上一页</button>
            <span
                style="padding: 0.25rem 0.5rem; background: var(--bg-sub); border-radius: 0.25rem; color: var(--text-main); font-size: 0.75rem; height: 100%;"
                x-text="wiCurrentPage + '/' + wiTotalPages"></span>
            <button @click="changeWiPage(wiCurrentPage+1)" :disabled="wiCurrentPage===wiTotalPages"
                class="btn-secondary" style="padding: 0.25rem 0.5rem;">下一页</button>
        </div>
    </div>
</div>