<!-- 移动卡片弹窗 -->
<div x-data="moveCardsModal" x-show="showMoveCardsModal" x-cloak class="modal-overlay z-modal-popover"
    @click.self="showMoveCardsModal = false">
    <div style="background: var(--bg-panel); padding: 0; border-radius: 1rem; width: 90vw; max-width: 400px; border: 1px solid var(--border-light); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); overflow: hidden; display: flex; flex-direction: column;">
        <!-- Header -->
        <div style="padding: 1rem 1.25rem; background: var(--bg-sub); border-bottom: 1px solid var(--border-light);">
            <h3 style="font-weight: bold; color: var(--text-main); font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                📂 移动到文件夹
            </h3>
        </div>
        
        <div style="padding: 1.25rem;">
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <label style="font-weight: 500; margin-bottom: 0.5rem; display: block; font-size: 0.875rem; color: var(--text-main);">选择目标文件夹</label>

                    <!-- 使用公共文件夹树选择组件 -->
                    <div x-data="folderTreeSelector({ 
                        selectedPathVar: 'targetCategory',
                        showQuickButtons: true,
                        maxHeight: '220px'
                    })" 
                    @folder-selected="targetCategory = $event.detail.path">
                        <!-- 快捷按钮 -->
                        <div x-show="showQuickButtons" class="flex gap-2 mb-2">
                            <button @click="selectFolder('')" :class="isSelected('') ? 'btn-primary' : 'btn-secondary'" class="flex-1 px-2 py-1 text-xs flex items-center justify-center gap-1">
                                <span>📂</span><span>当前浏览目录</span>
                            </button>
                            <button @click="selectFolder('根目录')" :class="isSelected('根目录') ? 'btn-primary' : 'btn-secondary'" class="flex-1 px-2 py-1 text-xs flex items-center justify-center gap-1">
                                <span>🏠</span><span>根目录</span>
                            </button>
                        </div>
                        <!-- 树形列表 -->
                        <div class="custom-scrollbar" :style="`max-height: ${maxHeight}; border-radius: 0.5rem; border: 1px solid var(--border-light); overflow-y: auto; background: var(--bg-sub); padding: 0.25rem 0;`">
                            <template x-for="folder in folderTree" :key="folder.path">
                                <div x-show="folder.visible" @click="selectFolder(folder.path)" class="flex items-center text-sm cursor-pointer transition-colors group" :class="[String(selectedPath) === String(folder.path) ? 'bg-[var(--accent-main)] text-white' : 'hover:bg-[var(--bg-hover)] text-[var(--text-main)]']" :style="`padding: 0.4rem 0.75rem; padding-left: ${0.75 + Math.min(folder.level, 3) * 0.75}rem;`">
                                    <!-- 展开/收起按钮 -->
                                    <button 
                                        x-show="folder.hasChildren"
                                        @click.stop="toggleFolder(folder.path, $event)"
                                        class="w-6 h-6 flex items-center justify-center opacity-70 hover:opacity-100 mr-1"
                                        style="background:none; border:none; color:inherit; cursor:pointer; flex-shrink: 0;">
                                        <span x-text="folder.expanded ? '▼' : '▶'" style="font-size: 10px;"></span>
                                    </button>
                                    <span x-show="!folder.hasChildren" 
                                        class="w-6 h-6 mr-1"></span>
                                    <span class="mr-2">📁</span>
                                    <span class="truncate" x-text="folder.name"></span>
                                </div>
                            </template>
                            <div x-show="folderTree.length === 0" class="px-3 py-2 text-xs text-[var(--text-dim)] text-center">暂无可用文件夹</div>
                        </div>
                    </div>

                    <div style="font-size: 0.75rem; color: var(--text-dim); margin-top: 0.5rem;">
                        将移动 <span x-text="cardIds.length" style="font-weight: bold;"></span> 张卡片
                    </div>
                </div>

                <div style="display: flex; gap: 0.75rem; margin-top: 0.5rem;">
                    <button @click="showMoveCardsModal = false" class="btn-secondary" style="flex:1; justify-content: center; font-size: 0.875rem; padding: 0.5rem;">
                        取消
                    </button>
                    <button @click="executeMove()" class="btn-primary" style="flex:2; justify-content: center; font-size: 0.875rem; padding: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        📂 移动
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
