/* ================================
   Detail Modal (Refactored)
   ================================ */
.detail-modal{
    width: min(1680px, calc(100vw - 240px));
    height: 92vh;
    background: var(--bg-panel);
    border: 1px solid var(--border-light);
    border-radius: 16px;
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7);
    overflow: visible;
    display: block; /* grid 交给 inner 容器 */
    position: relative;
}
/* 负责布局与裁剪的 inner 容器 */
.detail-modal-inner{
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-columns: 520px 1fr;
    overflow: hidden;
    border-radius: 16px; /* 把圆角挪到这里，确保内部仍被裁剪 */
    background: var(--bg-panel);
    border: 1px solid var(--border-light);
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7);
}
/* Filmstrip */
.detail-filmstrip-outside{
    position: absolute;
    left: -112px;            /* 悬浮在模态框外侧 */
    top: 14px;
    bottom: 14px;
    width: 104px;
    z-index: 60;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 10px 8px;
    background: rgba(0,0,0,0.22);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 16px;
    backdrop-filter: blur(8px);
    overflow-y: auto;
    overflow-x: hidden;
}

.detail-filmstrip-title{
    font-size: 10px;
    font-weight: 800;
    letter-spacing: 0.08em;
    color: rgba(255,255,255,0.65);
    text-align: center;
}
.detail-thumb{
    flex: 0 0 auto;
    flex-shrink: 0;
    position: relative;
    width: 88px;
    height: 88px;
    border-radius: 14px;
    overflow: hidden;
    border: 2px solid transparent;
    cursor: pointer;
    padding: 0;
    background: rgba(0,0,0,0.18);
    box-shadow: 0 4px 10px rgba(0,0,0,0.35);
    transition: transform 0.15s, border-color 0.15s;
}
.detail-thumb img{ width:100%; height:100%; object-fit: cover; display:block; }
.detail-thumb:hover{ transform: translateY(-1px); }
.detail-thumb-label{
    position: absolute;
    left: 0; right: 0; bottom: 0;
    font-size: 10px;
    padding: 3px 6px;
    background: rgba(0,0,0,0.55);
    color: #fff;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}
/* 浅色模式：用“白玻璃”而不是黑玻璃 */
html.light-mode .detail-filmstrip-outside{
    background: rgba(255,255,255,0.55);
    border: 1px solid rgba(17,24,39,0.12);
}
html.light-mode .detail-thumb{
    background: rgba(255,255,255,0.55);
    box-shadow: 0 8px 18px rgba(0,0,0,0.10);
}
html.light-mode .detail-thumb-label{
    background: rgba(17,24,39,0.55);
}
.detail-thumb.active-main{ border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59,130,246,0.25); }
.detail-thumb.active-skin{ border-color: #22c55e; box-shadow: 0 0 0 2px rgba(34,197,94,0.25); }

/* --- Right --- */
.detail-right{
    display: flex;
    flex-direction: column;
    min-height: 0;
    background: var(--bg-panel);
    color: var(--text-main);
}

.detail-topbar{
    position: sticky;
    top: 0;
    z-index: 20;
    background: color-mix(in srgb, var(--bg-panel), transparent 0%);
    border-bottom: 1px solid var(--border-light);
    padding: 14px 14px 10px 14px;
    padding-right: 56px;
    display: flex;
    gap: 12px;
    align-items: stretch;
}
/* 关闭按钮：永远右上角 */
.detail-close-floating{
    position: absolute;
    top: 12px;
    right: 12px;
    width: 36px;
    height: 36px;
    border-radius: 10px;
    padding: 0;
    font-size: 16px;
    z-index: 30;
}
.detail-title-block{ flex: 1; min-width: 0; }
.detail-title-row{ display:flex; flex-direction:column; gap:6px; }
.detail-title-label{
    font-size: 11px;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-dim);
}
.detail-title-input{
    width: 100%;
    font-size: 22px;
    font-weight: 900;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-main);
    outline: none;
    border-radius: 10px;
    padding: 6px 8px;
}
.detail-title-input:focus{
    border-color: var(--accent-main);
    background: color-mix(in srgb, var(--bg-sub), transparent 20%);
}

.detail-subrow{
    margin-top: 8px;
    display: flex;
    gap: 8px;
    align-items: center;
}
.detail-link-icon{ opacity: 0.7; flex-shrink: 0; }
.detail-link-input{
    flex: 1;
    min-width: 0;
    background: transparent;
    border: none;
    border-bottom: 1px dashed var(--border-light);
    padding: 4px 2px;
    color: var(--text-sub);
    outline: none;
}
.detail-link-input:focus{ border-bottom-color: var(--accent-main); color: var(--text-main); }
.detail-open-link{
    flex-shrink: 0;
    font-size: 12px;
    text-decoration: none;
    border: 1px solid var(--accent-main);
    color: var(--accent-light);
    padding: 2px 10px;
    border-radius: 999px;
}
.detail-open-link:hover{ background: var(--accent-faint); }

.detail-top-actions{
    display: flex;
    align-items: flex-end;
    justify-content: flex-end;
    flex-shrink: 0;
    min-width: 340px;
}

.detail-actions-row{
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: flex-end;
}

/* 统一高度：所有操作按钮同高，视觉不会“忽高忽低” */
.detail-circle-btn,
.detail-square-btn,
.detail-action-btn,
.detail-close-btn{
    height: 36px;
}

.detail-circle-btn{
    width: 36px;
    border-radius: 999px;
    padding: 0;
}

.detail-token{
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid var(--border-light);
    background: var(--bg-sub);
    text-align: right;
}
.detail-token-label{
    font-size: 10px;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-dim);
}
.detail-token-value{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 18px;
    font-weight: 900;
}
.detail-token-value.ok{ color: #22c55e; }
.detail-token-value.warn{ color: #f59e0b; }
.detail-token-value.danger{ color: #ef4444; }

.detail-toolbar-group{
    display: flex;
    gap: 6px;
    padding: 6px;
    border-radius: 12px;
    border: 1px solid var(--border-light);
    background: var(--bg-sub);
}
.detail-square-btn{
    width: 36px;
    height: 36px;
    padding: 0;
    border-radius: 10px;
}

.detail-action-btn{
    height: 36px;
    padding: 0 12px;
    border-radius: 10px;
    font-weight: 800;
}
.detail-save-btn{ box-shadow: 0 8px 20px rgba(0,0,0,0.25); }
.detail-close-btn{
    width: 36px;
    height: 36px;
    border-radius: 10px;
    padding: 0;
    font-size: 16px;
}

/* resource bar */
.detail-resourcebar{
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-bottom: 1px solid var(--border-main);
    background: color-mix(in srgb, var(--bg-sub), transparent 10%);
}
.detail-resource-title{
    font-size: 12px;
    font-weight: 900;
    color: #4ade80;
}
.detail-resource-path{ margin-top: 4px; }
.detail-chip{
    display: inline-flex;
    padding: 2px 10px;
    border-radius: 999px;
    border: 1px solid var(--border-light);
    background: var(--bg-panel);
    color: var(--text-main);
    font-size: 12px;
}
.detail-muted{ color: var(--text-dim); font-size: 12px; }
.detail-resource-actions{ display:flex; gap:8px; }
.detail-mini-btn{
    height: 28px;
    padding: 0 10px;
    border-radius: 10px;
    font-size: 12px;
}

/* Tabs */
.detail-tabs{
    display: flex;
    gap: 8px;
    padding: 10px 14px;
    border-bottom: 1px solid var(--border-main);
    background: var(--bg-panel);
    position: sticky;
    top: 82px; /* 顶部栏高度大致 */
    z-index: 15;
}
.detail-tab{
    border: 1px solid var(--border-light);
    background: var(--bg-sub);
    color: var(--text-sub);
    padding: 8px 10px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 800;
    transition: all 0.15s;
}
.detail-tab:hover{
    background: var(--bg-hover);
    color: var(--text-main);
}
.detail-tab.active{
    background: var(--accent-main);
    color: var(--text-on-accent);
    border-color: var(--accent-light);
}

/* Content */
.detail-content{
    flex: 1;
    min-height: 0;
    overflow: hidden;          /* 关键：把滚动交给 tab 内部 */
    padding: 14px;
    display: flex;
    flex-direction: column;
    background: var(--bg-panel);
}
.detail-section{
    flex: 1;
    min-height: 0;
    display:flex;
    flex-direction:column;
    gap:12px;
    overflow-y: auto; 
    overflow-x: hidden;
}

/* 确保滚动条适配主题 (如果未全局应用) */
.detail-section::-webkit-scrollbar { width: 8px; }
.detail-section::-webkit-scrollbar-track { background: transparent; }
.detail-section::-webkit-scrollbar-thumb { 
    background: var(--scrollbar-thumb); 
    border-radius: 4px; 
}
.detail-section::-webkit-scrollbar-thumb:hover { 
    background: var(--accent-light); 
}

/* 只给需要“填满”的 tab 用（基础/对话/wi） */
.detail-section-fill{
    flex: 1;
    min-height: 0;
    overflow: hidden;
}
.detail-section-fill .detail-card{
    min-height: 0;
    display: flex;
    flex-direction: column;
}
.detail-section-fill .form-textarea{
    flex: 1;
    min-height: 0;
    height: auto !important;   /* 覆盖你写死的 10rem */
    resize: none;
}
/* tab 内滚动区（让某些 tab 自己滚） */
.detail-tab-scroll{
    flex: 1;
    min-height: 0;
    overflow: auto;
}

.detail-grid-2{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}
@media (max-width: 1100px){
  .detail-modal{ grid-template-columns: 420px 1fr; }
}
@media (max-width: 980px){
  .detail-modal{ grid-template-columns: 1fr; height: 94vh; width: 96vw; }
  .detail-left{ display:none; } /* 小屏可以先隐藏左侧（不丢功能：你可改成折叠） */
  .detail-tabs{ top: 0; position: sticky; } 
  .detail-grid-2{ grid-template-columns: 1fr; }
  .detail-filmstrip-outside { display: none !important; }
}

/* Cards inside right content */
.detail-card{
    border: 1px solid var(--border-light);
    background: color-mix(in srgb, var(--bg-sub), transparent 10%);
    border-radius: 14px;
    padding: 12px;
}
.detail-card-head{
    display:flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    gap: 10px;
}
.detail-card-head-row{ align-items:flex-start; }
.detail-card-title{
    font-size: 13px;
    font-weight: 900;
    color: var(--text-main);
}
.detail-card-actions{
    display:flex;
    gap: 10px;
    align-items: center;
    flex-shrink: 0;
}

/* Alternate greeting controls */
.detail-alt-nav{
    display:flex;
    align-items:center;
    gap: 8px;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid var(--border-light);
    background: var(--bg-panel);
}
.detail-alt-btn{
    border:none;
    background: transparent;
    color: var(--text-main);
    font-weight: 900;
    cursor: pointer;
}
.detail-alt-count{
    font-size: 12px;
    color: var(--text-dim);
}

/* Tag list */
.detail-taglist{
    display:flex;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 34px;
}
.detail-tag{
    display:inline-flex;
    align-items:center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(124,58,237,0.35);
    background: rgba(124,58,237,0.18);
    color: var(--text-main);
    cursor: pointer;
    font-size: 12px;
    font-weight: 700;
    transition: all 0.15s;
}
.detail-tag:hover{
    transform: translateY(-1px);
    border-color: rgba(124,58,237,0.6);
}
.detail-tag-x{ opacity: 0.75; }
.detail-tag:hover .detail-tag-x{ color: #f87171; opacity: 1; }

/* Inline tag input */
.detail-inline-input{
    display:flex;
    border: 1px solid var(--border-light);
    border-radius: 10px;
    overflow: hidden;
    background: var(--bg-panel);
}
.detail-inline-text{
    border: none;
    outline: none;
    background: transparent;
    padding: 6px 10px;
    color: var(--text-main);
    width: 120px;
    font-size: 12px;
}
.detail-inline-add{
    border: none;
    background: var(--bg-hover);
    color: var(--text-main);
    padding: 0 10px;
    cursor: pointer;
}
.detail-inline-add:hover{ background: var(--accent-faint); }

/* Manage */
.detail-manage-grid{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 10px;
}
@media (max-width: 860px){
  .detail-manage-grid{ grid-template-columns: 1fr; }
}
.detail-manage-box{
    border: 1px solid var(--border-light);
    background: var(--bg-panel);
    border-radius: 12px;
    padding: 12px;
}
.detail-manage-box.danger{
    border-color: rgba(239,68,68,0.5);
    background: color-mix(in srgb, rgba(239,68,68,0.10), var(--bg-panel));
}
.detail-manage-label{
    font-weight: 900;
    margin-bottom: 4px;
}
.detail-manage-actions{
    margin-top: 10px;
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}
.detail-snapshot-btn{
    border-color: rgba(245,158,11,0.55);   /* amber */
    color: #fbbf24;
    background: color-mix(in srgb, var(--bg-sub), rgba(245,158,11,0.12));
    font-weight: 800;
}
.detail-snapshot-btn:hover{
    border-color: rgba(245,158,11,0.85);
    background: color-mix(in srgb, var(--bg-hover), rgba(245,158,11,0.18));
    color: #ffd166;
}

/* 让可填充的 tab 变成纵向 flex 容器，并允许子项分配高度 */
.detail-section-fill .detail-tab-scroll{
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-height: 0;
}

/* 默认：每个卡片都可以伸展吃剩余空间 */
.detail-section-fill .detail-tab-scroll > .detail-card{
    flex: 1 1 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
}

/* 卡片内部 textarea 真正“贴底长大” */
.detail-section-fill .detail-card .form-textarea{
    flex: 1;
    min-height: 0;
    height: auto !important; /* 覆盖你 HTML 里写死的 10rem */
    resize: none;
}

/* 给某些卡片更大权重（用于对话页：First Message 更重要） */
.detail-card--lg{ flex: 2 1 0 !important; }
.detail-card--sm{ flex: 0.8 1 0 !important; }

/* Detail 内的 WI 容器改为可伸展布局，覆盖默认 max-height */
.detail-section-fill .wi-container{
    display: flex;
    flex-direction: column;
    min-height: 0;
}
.detail-section-fill .wi-content{
    flex: 1;
    min-height: 0;
    max-height: none !important;
}

/* ===== 3) Manage toolbox ===== */
.detail-toolbox{
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.toolbox-group{
    border: 1px dashed color-mix(in srgb, var(--border-light), transparent 25%);
    border-radius: 12px;
    padding: 10px;
    background: color-mix(in srgb, var(--bg-panel), transparent 10%);
}

.toolbox-title{
    font-size: 12px;
    font-weight: 900;
    color: var(--text-dim);
    margin-bottom: 8px;
    letter-spacing: 0.04em;
}

.toolbox-grid{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
}
@media (max-width: 860px){
    .toolbox-grid{ grid-template-columns: 1fr; }
}

.toolbox-btn{
    height: 38px;
    border-radius: 12px;
    border: 1px solid var(--border-light);
    background: var(--bg-sub);
    color: var(--text-main);
    font-weight: 800;
    font-size: 13px;
    cursor: pointer;
    transition: transform .12s, border-color .12s, background-color .12s, box-shadow .12s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}
.toolbox-btn:hover{
    transform: translateY(-1px);
    border-color: var(--accent-main);
    background: var(--bg-hover);
    box-shadow: 0 10px 18px rgba(0,0,0,0.18);
}
.toolbox-btn.warn{
    border-color: rgba(245,158,11,0.55);
    color: #f59e0b;
}
.toolbox-btn.amber{
    border-color: rgba(245,158,11,0.55);
    color: #fbbf24;
}
.toolbox-btn.purple{
    border-color: rgba(124,58,237,0.55);
    color: #c4b5fd;
}
html.light-mode .toolbox-btn.purple{
    color: #6d28d9;
}
/* === 详情页响应式布局 === */
/* 1. 调整模态框宽度逻辑，小屏下占据更多空间 */
.detail-modal {
    /* 默认: 也就是大屏下，保持原有关边距设计 */
    width: min(1680px, calc(100vw - 120px)); 
    /* 增加最小宽度，防止过度挤压 */
    min-width: 320px; 
}

/* 2. 优化内部 Grid 布局 */
.detail-modal-inner {
    /* 确保内容不会溢出容器，而是出现滚动条 */
    overflow-x: auto; 
}

/* 3. 顶部工具栏防截断 */
.detail-topbar {
    /* 允许在极窄屏幕下换行，或者保持在一行但允许压缩 */
    flex-wrap: wrap; 
    min-width: 0; /* 允许 Flex 子项收缩 */
}
.detail-title-block {
    min-width: 200px; /* 给标题留最小空间 */
}
.detail-top-actions {
    /* 防止操作按钮被挤没 */
    flex-shrink: 0; 
}

/* 4. 针对不同分辨率的断点优化 */
@media (max-width: 1200px) {
    .detail-modal {
        /* 中等屏幕：增加宽度占比 */
        width: 96vw;
        height: 94vh;
    }
    .detail-modal-inner {
        /* 左侧栏稍微缩小 */
        grid-template-columns: 380px 1fr; 
    }
}

@media (max-width: 850px) {
    .detail-modal {
        width: 98vw;
        height: 96vh;
    }
    .detail-modal-inner {
        /* 小屏强制单列，左侧栏隐藏或变为顶部 */
        grid-template-columns: 1fr;
    }
    .detail-left {
        display: none; /* 或者改为其它显示方式 */
    }
    /* 移动端 Topbar 优化 */
    .detail-topbar {
        padding-right: 14px; /* 移除给悬浮关闭按钮留的 padding */
    }
    .detail-close-floating {
        position: relative;
        top: auto; right: auto;
        margin-left: auto;
    }
}
/* --- Left --- */
.detail-left{
    position: relative;
    background: var(--bg-modal-left);
    border-right: 1px solid var(--border-main);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.detail-image-area{
    position: relative;
    flex: 1;
    min-height: 0;
    overflow: hidden;
}

.detail-image-scroll{
    position: absolute;
    inset: 0;
    overflow: auto;
    display: flex;
    cursor: grab;
    user-select: none;
}
.detail-image-scroll:active{ cursor: grabbing; }

.detail-image{
    display: block;
    margin: auto;
    height: auto;
    max-height: none;
    flex-shrink: 0;
    transition: width 75ms linear;
}

.detail-left-toolbar{
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 30;
    display: flex;
    gap: 8px;
}
.detail-icon-btn{
    width: 36px;
    height: 36px;
    border-radius: 10px;
    padding: 0;
    font-size: 14px;
}

.detail-zoombar{
    position: absolute;
    left: 50%;
    bottom: 14px;
    transform: translateX(-50%);
    z-index: 30;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    background: rgba(0,0,0,0.55);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 999px;
    backdrop-filter: blur(6px);
}
.detail-zoom-btn{
    width: 26px;
    height: 26px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.2);
    color: #fff;
    cursor: pointer;
}
.detail-zoom-btn:hover{ border-color: rgba(255,255,255,0.35); }

.detail-zoom-range{ width: 120px; }
.detail-zoom-text{
    font-size: 12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    color: rgba(255,255,255,0.85);
    width: 48px;
    text-align: right;
}
.detail-zoom-reset{
    border: none;
    background: transparent;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    font-weight: bold;
}
.detail-zoom-reset:hover{ color: #fff; }

.detail-metadata{
    position: absolute;
    inset: 0;
    z-index: 25;
    display: flex;
    flex-direction: column;
    background: var(--bg-code);
    color: var(--text-code);
}
.detail-metadata-header{
    padding: 10px 12px;
    border-bottom: 1px solid var(--border-light);
    background: var(--bg-sub);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}
.detail-metadata-body{
    margin: 0;
    padding: 12px;
    overflow: auto;
    flex: 1;
    white-space: pre-wrap;
    word-break: break-word;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 12px;
    line-height: 1.5;
}

/* 修改时间徽章 */
.detail-mtime-badge {
    font-size: 10px;
    font-family: ui-monospace, monospace;
    padding: 2px 6px;
    border-radius: 4px;
    background: var(--bg-sub);
    border: 1px solid var(--border-light);
    color: var(--text-dim);
    display: flex;
    align-items: center;
    gap: 4px;
    height: 100%;
}

/* Versions bar */
.detail-versions{
    height: 90px !important; 
    border-top: 1px solid rgba(255,255,255,0.08);
    background: rgba(0,0,0,0.35);
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px;
    overflow-x: auto;
    overflow-y: hidden;
    flex-wrap: nowrap;
    flex-shrink: 0;
}
.detail-versions-title{
    font-size: 10px;
    letter-spacing: 0.08em;
    font-weight: 800;
    color: #fbbf24;
    opacity: 0.9;
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    flex-shrink: 0;
}
.detail-version{
    flex: 0 0 auto;
    flex-shrink: 0;
    width: 56px;
    height: 52px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.25);
    color: rgba(255,255,255,0.85);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 2px;
    padding: 6px;
    opacity: 0.7;
    transition: all 0.15s;
}
.detail-version:hover{ opacity: 1; transform: translateY(-1px); }
.detail-version.active{
    opacity: 1;
    border-color: #fbbf24;
    box-shadow: 0 0 0 2px rgba(251,191,36,0.15);
}
.detail-version-top{ font-size: 10px; opacity: 0.7; }
.detail-version-name{
    font-size: 10px;
    font-weight: 700;
    line-height: 1.1;
    word-break: break-all;
}

.detail-version-thumb-btn {
    flex: 0 0 auto;
    width: 60px;
    height: 70px;
    border-radius: 8px;
    border: 2px solid transparent;
    background: var(--bg-sub);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    flex-direction: column;
}

.detail-version-thumb-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.detail-version-thumb-btn.active {
    border-color: #fbbf24; /* Amber */
    box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.3);
}

/* 缩略图图片 */
.detail-version-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.7;
    transition: opacity 0.2s;
}
.detail-version-thumb-btn.active .detail-version-img,
.detail-version-thumb-btn:hover .detail-version-img {
    opacity: 1;
}

/* 版本号/文件名覆盖层 */
.detail-version-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    font-size: 9px;
    padding: 2px 4px;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    backdrop-filter: blur(2px);
}

/* 设为封面按钮 (悬浮在缩略图上) */
.detail-version-set-cover {
    position: absolute;
    top: 2px;
    right: 2px;
    width: 16px;
    height: 16px;
    background: rgba(0,0,0,0.6);
    color: #fbbf24;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 10;
}
.detail-version-thumb-btn:hover .detail-version-set-cover {
    opacity: 1;
}
.detail-version-set-cover:hover {
    background: #fbbf24;
    color: black;
}
/* 详情页工具栏按钮组 */
.toolbar-group {
    display: flex; gap: 4px; background: var(--bg-sub); 
    padding: 4px; border-radius: 8px; border: 1px solid var(--border-light);
}
/* Token 显示优化 (移动到顶部工具栏后的样式) */
.topbar-token {
    display: flex;
    flex-direction: column;
    align-items: flex-end; /* 右对齐 */
    justify-content: center;
    padding: 0 12px;
    border-right: 1px solid var(--border-light);
    height: 100%;
    flex-shrink: 0;
}
.topbar-token-label {
    font-size: 9px;
    color: var(--text-dim);
    text-transform: uppercase;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 2px;
}
.topbar-token-value {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 15px;
    font-weight: 900;
    line-height: 1;
}
.topbar-token-value.ok { color: #22c55e; }
.topbar-token-value.warn { color: #f59e0b; }
.topbar-token-value.danger { color: #ef4444; }
/* WI Raw 数据区域适配 */
.wi-raw-section {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border-light);
}
.wi-raw-textarea {
    background-color: var(--bg-code);
    color: var(--text-code);
    font-family: monospace;
    font-size: 0.75rem;
    border: 1px solid var(--border-light);
    border-radius: 0.375rem;
}
/* 更新角色卡按钮优化 */
.btn-update-card {
    background-color: var(--bg-sub);
    border: 1px solid var(--border-light);
    color: var(--text-sub);
    padding: 0.4rem 0.8rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    display: flex; align-items: center; gap: 0.4rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 1px 2px var(--shadow-color);
}
.btn-update-card:hover {
    background-color: var(--bg-panel);
    border-color: var(--accent-light);
    color: var(--accent-main);
    transform: translateY(-1px);
    box-shadow: 0 4px 6px -1px var(--shadow-color);
}
/* 给两个按钮加一点微小的颜色区分 */
.btn-update-file:hover { color: #60a5fa; border-color: #60a5fa; } /* 蓝 */
.btn-update-url:hover { color: #c084fc; border-color: #c084fc; }  /* 紫 */
/* === 本地备注专属样式 (Local Note) === */
.note-textarea {
    /* 1. 背景色联动：使用当前背景色 + 8% 的主题强调色混合 */
    /* 这样如果是蓝色主题，背景就是淡蓝灰；如果是红色主题，就是淡红灰 */
    background-color: color-mix(in srgb, var(--bg-sub), var(--accent-main) 8%) !important;
    
    /* 2. 边框联动：使用虚线 (dashed) 表示这是"便签/备注"性质，与开场白的实线区分 */
    border: 1px dashed var(--accent-light) !important;
    
    /* 3. 文字颜色保持继承，确保对比度 */
    color: var(--text-main);
    
    /* 4. 添加过渡动画 */
    transition: all 0.2s ease-in-out;
}

/* 聚焦状态：加深颜色，边框变实线 */
.note-textarea:focus {
    /* 聚焦时混合浓度提升到 12%，更明显 */
    background-color: color-mix(in srgb, var(--bg-sub), var(--accent-main) 12%) !important;
    
    /* 聚焦时变回实线，表示正在编辑 */
    border-style: solid !important;
    border-color: var(--accent-main) !important;
    
    /* 添加主题色的光晕 */
    box-shadow: 0 0 0 2px var(--accent-faint);
}

/* === 浅色模式适配 (Light Mode) === */
html.light-mode .note-textarea {
    /* 浅色模式下，混合 10% 的强调色到纯白或面板背景中 */
    /* 结果会是像"信纸"一样的淡彩色背景 */
    background-color: color-mix(in srgb, var(--bg-panel), var(--accent-main) 10%) !important;
    border-color: var(--accent-main) !important;
    opacity: 0.95;
}

html.light-mode .note-textarea:focus {
    background-color: color-mix(in srgb, var(--bg-panel), var(--accent-main) 18%) !important;
}
